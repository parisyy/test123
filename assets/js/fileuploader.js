/*
 * EnhanceJS version 1.1 - Test-Driven Progressive Enhancement
 * http://enhancejs.googlecode.com/
 * Copyright (c) 2010 Filament Group, Inc, authors.txt
 * Licensed under MIT (license.txt)
*/(function(e,t,n){function r(){return!!t.cookie}function i(){x(k.testName,"fail"),e.location.reload()}function s(){x(k.testName,"pass"),e.location.reload()}function o(){N(k.testName),e.location.reload()}function u(){A=t.createElement("body"),_.insertBefore(A,_.firstChild),L=A}function a(){_.removeChild(A),L=t.body}function f(){var e=T(k.testName);if(e)e==="pass"?(p(),k.onPass()):(k.onFail(),h()),k.appendToggleLink&&l(function(){c(e)});else{var t=!0;u();for(var n in k.tests){t=k.tests[n]();if(!t){k.alertOnFailure&&alert(n+" failed");break}}a(),e=t?"pass":"fail",x(k.testName,e),t?(p(),k.onPass()):(k.onFail(),h()),k.appendToggleLink&&l(function(){c(e)})}}function l(t){if(O)t();else{var n=e.onload;e.onload=function(){n&&n(),t()}}}function c(e){if(!k.appendToggleLink||!enhance.cookiesSupported)return;if(e){var n=t.createElement("a");n.href="#",n.className=k.testName+"_toggleResult",n.innerHTML=e==="pass"?k.forceFailText:k.forcePassText,n.onclick=e==="pass"?enhance.forceFail:enhance.forcePass,t.getElementsByTagName("body")[0].appendChild(n)}}function h(){_.className=_.className.replace(k.testName,"")}function p(){D=!0,k.loadStyles.length&&y(),k.loadScripts.length?b():k.onScriptsLoaded()}function d(t,n){T(P)&&T(H)?(N(P),N(H)):(x(P,t),x(H,n)),e.location.reload()}function v(e){return B.length==2&&(e==B[0]?e=B[1]:e==B[1]&&(e=B[0])),e}function m(){var e=k.testName+"-incomplete";_.className.indexOf(e)===-1&&(_.className+=" "+e)}function g(e){if(e.constructor===Array){var t=!0;for(var n in e)t&&(t=!!e[n]);return t}return!!e}function y(){var e=-1,r;while(r=k.loadStyles[++e]){var i=t.createElement("link");i.type="text/css",i.rel="stylesheet",i.onerror=k.onLoadError;if(typeof r=="string")i.href=r,M.appendChild(i);else{r.media&&(r.media=v(r.media),k.media&&k.media[r.media]!==n&&(r.media=k.media[r.media])),r.excludemedia&&(r.excludemedia=v(r.excludemedia));var s=!0;r.media&&r.media!=="print"&&r.media!=="projection"&&r.media!=="speech"&&r.media!=="aural"&&r.media!=="braille"&&(s=j(r.media)),s&&r.excludemedia&&(s=!j(r.excludemedia)),s&&r.iecondition&&(s=F(r.iecondition)),s&&r.ifsupported!==n&&(s=g(r.ifsupported),!s&&r.fallback!==n&&(r.href=r.fallback,s=!0));if(s){for(var o in r)o!=="iecondition"&&o!=="excludemedia"&&o!=="ifsupported"&&o!=="fallback"&&i.setAttribute(o,r[o]);M.appendChild(i)}}}}function b(){k.queueLoading?w():E()}function w(){function e(){if(t.length===0)return!1;var n=t.shift(),r=S(n),i=!1;if(!r)return e();r.onload=r.onreadystatechange=function(){!i&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")&&(i=!0,e()===!1&&k.onScriptsLoaded(),this.onload=this.onreadystatechange=null)},M.insertBefore(r,M.firstChild)}var t=[].concat(k.loadScripts);e()}function E(){var e=-1,t;while(t=k.loadScripts[++e]){var n=S(t);n&&M.insertBefore(n,M.firstChild)}k.onScriptsLoaded()}function S(e){var r=t.createElement("script");r.type="text/javascript",r.onerror=k.onLoadError;if(typeof e=="string")return r.src=e,r;e.media&&(e.media=v(e.media),k.media&&k.media[e.media]&&(e.media=k.media[e.media])),e.excludemedia&&(e.excludemedia=v(e.excludemedia));var i=!0;e.media&&(i=j(e.media)),i&&e.excludemedia&&(i=!j(e.excludemedia)),i&&e.iecondition&&(i=F(e.iecondition)),i&&e.ifsupported!==n&&(i=g(e.ifsupported),!i&&e.fallback!==n&&(e.src=e.fallback,i=!0));if(i){for(var s in e)s!=="iecondition"&&s!=="media"&&s!=="excludemedia"&&s!=="ifsupported"&&s!=="fallback"&&r.setAttribute(s,e[s]);return r}return!1}function x(e,n,r){r=r||90;var i=new Date;i.setTime(i.getTime()+r*24*60*60*1e3);var s="; expires="+i.toGMTString();t.cookie=e+"="+n+s+"; path=/"}function T(e){var n=e+"=",r=t.cookie.split(";");for(var i=0;i<r.length;i++){var s=r[i];while(s.charAt(0)==" ")s=s.substring(1,s.length);if(s.indexOf(n)==0)return s.substring(n.length,s.length)}return null}function N(e){x(e,"",-1)}function C(){t.readyState==null&&t.addEventListener&&(t.addEventListener("DOMContentLoaded",function e(){t.removeEventListener("DOMContentLoaded",e,!1),t.readyState="complete"},!1),t.readyState="loading")}var k,L,A,O,M,_=t.documentElement,D=!1,P,H,B=[];t.getElementsByTagName?M=t.getElementsByTagName("head")[0]||_:M=_;var j=function(){var e={},r=t.createElement("div");return r.setAttribute("id","ejs-qtest"),function(i){if(e[i]===n){u();var s=t.createElement("style");s.type="text/css",M.appendChild(s);var o="@media "+i+" { #ejs-qtest { position: absolute; width: 10px; } }";s.styleSheet?s.styleSheet.cssText=o:s.appendChild(t.createTextNode(o)),L.appendChild(r);var f=r.offsetWidth;L.removeChild(r),M.removeChild(s),a(),e[i]=f==10}return e[i]}}();e.enhance=function(e){e=e||{},k={};for(var t in enhance.defaultSettings){var r=e[t];k[t]=r!==n?r:enhance.defaultSettings[t]}for(var i in e.addTests)k.tests[i]=e.addTests[i];_.className.indexOf(k.testName)===-1&&(_.className+=" "+k.testName),P=k.testName+"-toggledmediaA",H=k.testName+"-toggledmediaB",B=[T(P),T(H)],setTimeout(function(){D||h()},3e3),f(),C(),l(function(){O=!0})},enhance.query=j,enhance.defaultTests={getById:function(){return!!t.getElementById},getByTagName:function(){return!!t.getElementsByTagName},createEl:function(){return!!t.createElement},boxmodel:function(){var e=t.createElement("div");e.style.cssText="width: 1px; padding: 1px;",L.appendChild(e);var n=e.offsetWidth;return L.removeChild(e),n===3},position:function(){var e=t.createElement("div");e.style.cssText="position: absolute; left: 10px;",L.appendChild(e);var n=e.offsetLeft;return L.removeChild(e),n===10},floatClear:function(){var e=!1,n=t.createElement("div"),r='style="width: 5px; height: 5px; float: left;"';n.innerHTML="<div "+r+"></div><div "+r+"></div>",L.appendChild(n);var i=n.childNodes,s=i[0].offsetTop,o=i[1],u=o.offsetTop;return s===u&&(o.style.clear="left",u=o.offsetTop,s!==u&&(e=!0)),L.removeChild(n),e},heightOverflow:function(){var e=t.createElement("div");e.innerHTML='<div style="height: 10px;"></div>',e.style.cssText="overflow: hidden; height: 0;",L.appendChild(e);var n=e.offsetHeight;return L.removeChild(e),n===0},ajax:function(){var e=!1,t=-1,n,r=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];while(n=r[++t]){try{e=n()}catch(i){continue}break}return!!e},resize:function(){return e.onresize!=0},print:function(){return!!e.print}},enhance.defaultSettings={testName:"enhanced",loadScripts:[],loadStyles:[],queueLoading:!0,appendToggleLink:!0,forcePassText:"View high-bandwidth version",forceFailText:"View low-bandwidth version",tests:enhance.defaultTests,media:{"-ejs-desktop":enhance.query("screen and (max-device-width: 1024px)")?"not screen and (max-device-width: 1024px)":"screen","-ejs-handheld":"screen and (max-device-width: 1024px)"},addTests:{},alertOnFailure:!1,onPass:function(){},onFail:function(){},onLoadError:m,onScriptsLoaded:function(){}},enhance.cookiesSupported=r(),enhance.cookiesSupported&&(enhance.forceFail=i),enhance.cookiesSupported&&(enhance.forcePass=s),enhance.cookiesSupported&&(enhance.reTest=o),enhance.toggleMedia=d;var F=function(){var e={},t;return function(e){return!1}}()})(window,document),$.fn.customFileInput=function(e){var t=$(this),n=jQuery.extend({button_position:"right",classes:t.attr("class"),feedback_text:"No file selected...",button_text:"Browse",button_change_text:"Change"},e);t.addClass("customfile-input").focus(function(){r.addClass("customfile-focus"),t.data("val",t.val())}).blur(function(){r.removeClass("customfile-focus"),$(this).trigger("checkChange")}).bind("disable",function(){t.attr("disabled",!0),r.addClass("customfile-disabled")}).bind("enable",function(){t.removeAttr("disabled"),r.removeClass("customfile-disabled")}).bind("checkChange",function(){t.val()&&t.val()!=t.data("val")&&t.trigger("change")}).bind("change",function(){var e=$(this).val().split(/\\/).pop(),t="customfile-ext-"+e.split(".").pop().toLowerCase();i.css({width:"-=21"}).text(e).removeClass(i.data("fileExt")||"").addClass(t).data("fileExt",t).addClass("customfile-feedback-populated"),s.text(n.button_change_text)}).click(function(){t.data("val",t.val()),setTimeout(function(){t.trigger("checkChange")},100)});var r=$('<div class="input-'+("right"===n.button_position?"append":"prepend")+' customfile">'),i=$('<span class="customfile-feedback '+n.classes+'" aria-hidden="true">'+n.feedback_text+"</span>").appendTo(r),s=$('<span class="add-on customfile-button" aria-hidden="true">'+n.button_text+"</span>").css({"float":n.button_position});return"right"===n.button_position?s.insertAfter(i):s.insertBefore(i),t.is("[disabled]")?t.trigger("disable"):r.click(function(){t.trigger("click")}),r.insertAfter(t),t.insertAfter(r),$(this)},function(){function addEvent(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else{if(!e.attachEvent)throw new Error("not supported or DOM not loaded");e.attachEvent("on"+t,function(){n.call(e)})}}function addResizeEvent(e){var t;addEvent(window,"resize",function(){t&&clearTimeout(t),t=setTimeout(e,100)})}function getBox(e){var t,n,r,i,s=getOffset(e);return t=s.left,r=s.top,n=t+e.offsetWidth,i=r+e.offsetHeight,{left:t,right:n,top:r,bottom:i}}function addStyles(e,t){for(var n in t)t.hasOwnProperty(n)&&(e.style[n]=t[n])}function copyLayout(e,t){var n=getBox(e);addStyles(t,{position:"absolute",left:n.left+"px",top:n.top+"px",width:e.offsetWidth+"px",height:e.offsetHeight+"px"})}function fileFromPath(e){return e.replace(/.*(\/|\\)/,"")}function getExt(e){return-1!==e.indexOf(".")?e.replace(/.*[.]/,""):""}function hasClass(e,t){var n=new RegExp("\\b"+t+"\\b");return n.test(e.className)}function addClass(e,t){hasClass(e,t)||(e.className+=" "+t)}function removeClass(e,t){var n=new RegExp("\\b"+t+"\\b");e.className=e.className.replace(n,"")}function removeNode(e){e.parentNode.removeChild(e)}if(document.documentElement.getBoundingClientRect)var getOffset=function(e){var t=e.getBoundingClientRect(),n=e.ownerDocument,r=n.body,i=n.documentElement,s=i.clientTop||r.clientTop||0,o=i.clientLeft||r.clientLeft||0,u=1;if(r.getBoundingClientRect){var a=r.getBoundingClientRect();u=(a.right-a.left)/r.clientWidth}u>1&&(s=0,o=0);var f=t.top/u+(window.pageYOffset||i&&i.scrollTop/u||r.scrollTop/u)-s,l=t.left/u+(window.pageXOffset||i&&i.scrollLeft/u||r.scrollLeft/u)-o;return{top:f,left:l}};else var getOffset=function(e){var t=0,n=0;do t+=e.offsetTop||0,n+=e.offsetLeft||0,e=e.offsetParent;while(e);return{left:n,top:t}};var toElement=function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var n=e.firstChild;return e.removeChild(n)}}(),getUID=function(){var e=0;return function(){return"ValumsAjaxUpload"+e++}}();window.AjaxUpload=function(e,t){this._settings={action:"upload.php",name:"userfile",multiple:!1,data:{},autoSubmit:!0,responseType:!1,hoverClass:"hover",focusClass:"focus",disabledClass:"disabled",onChange:function(e,t){},onSubmit:function(e,t){},onComplete:function(e,t){}};for(var n in t)t.hasOwnProperty(n)&&(this._settings[n]=t[n]);e.jquery?e=e[0]:typeof e=="string"&&(/^#.*/.test(e)&&(e=e.slice(1)),e=document.getElementById(e));if(!e||e.nodeType!==1)throw new Error("Please make sure that you're passing a valid element");e.nodeName.toUpperCase()=="A"&&addEvent(e,"click",function(e){e&&e.preventDefault?e.preventDefault():window.event&&(window.event.returnValue=!1)}),this._button=e,this._input=null,this._disabled=!1,this.enable(),this._rerouteClicks()},AjaxUpload.prototype={setData:function(e){this._settings.data=e},disable:function(){addClass(this._button,this._settings.disabledClass),this._disabled=!0;var e=this._button.nodeName.toUpperCase();(e=="INPUT"||e=="BUTTON")&&this._button.setAttribute("disabled","disabled"),this._input&&this._input.parentNode&&(this._input.parentNode.style.visibility="hidden")},enable:function(){removeClass(this._button,this._settings.disabledClass),this._button.removeAttribute("disabled"),this._disabled=!1},_createInput:function(){var e=this,t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("name",this._settings.name),this._settings.multiple&&t.setAttribute("multiple","multiple"),addStyles(t,{position:"absolute",right:0,margin:0,padding:0,fontSize:"480px",fontFamily:"sans-serif",cursor:"pointer"});var n=document.createElement("div");addStyles(n,{display:"block",position:"absolute",overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:2147483583});if(n.style.opacity!=="0"){if(typeof n.filters=="undefined")throw new Error("Opacity not supported by the browser");n.style.filter="alpha(opacity=0)"}addEvent(t,"change",function(){if(!t||t.value==="")return;var n=fileFromPath(t.value);if(!1===e._settings.onChange.call(e,n,getExt(n))){e._clearInput();return}e._settings.autoSubmit&&e.submit()}),addEvent(t,"mouseover",function(){addClass(e._button,e._settings.hoverClass)}),addEvent(t,"mouseout",function(){removeClass(e._button,e._settings.hoverClass),removeClass(e._button,e._settings.focusClass),t.parentNode&&(t.parentNode.style.visibility="hidden")}),addEvent(t,"focus",function(){addClass(e._button,e._settings.focusClass)}),addEvent(t,"blur",function(){removeClass(e._button,e._settings.focusClass)}),n.appendChild(t),document.body.appendChild(n),this._input=t},_clearInput:function(){if(!this._input)return;removeNode(this._input.parentNode),this._input=null,this._createInput(),removeClass(this._button,this._settings.hoverClass),removeClass(this._button,this._settings.focusClass)},_rerouteClicks:function(){var e=this;addEvent(e._button,"mouseover",function(){if(e._disabled)return;e._input||e._createInput();var t=e._input.parentNode;copyLayout(e._button,t),t.style.visibility="visible"})},_createIframe:function(){var e=getUID(),t=toElement('<iframe src="javascript:false;" name="'+e+'" />');return t.setAttribute("id",e),t.style.display="none",document.body.appendChild(t),t},_createForm:function(e){var t=this._settings,n=toElement('<form method="post" enctype="multipart/form-data"></form>');n.setAttribute("action",t.action),n.setAttribute("target",e.name),n.style.display="none",document.body.appendChild(n);for(var r in t.data)if(t.data.hasOwnProperty(r)){var i=document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("name",r),i.setAttribute("value",t.data[r]),n.appendChild(i)}return n},_getResponse:function(iframe,file){var toDeleteFlag=!1,self=this,settings=this._settings;addEvent(iframe,"load",function(){if(iframe.src=="javascript:'%3Chtml%3E%3C/html%3E';"||iframe.src=="javascript:'<html></html>';"){toDeleteFlag&&setTimeout(function(){removeNode(iframe)},0);return}var doc=iframe.contentDocument?iframe.contentDocument:window.frames[iframe.id].document;if(doc.readyState&&doc.readyState!="complete")return;if(doc.body&&doc.body.innerHTML=="false")return;var response;doc.XMLDocument?response=doc.XMLDocument:doc.body?(response=doc.body.innerHTML,settings.responseType&&settings.responseType.toLowerCase()=="json"&&(doc.body.firstChild&&doc.body.firstChild.nodeName.toUpperCase()=="PRE"&&(doc.normalize(),response=doc.body.firstChild.firstChild.nodeValue),response?response=eval("("+response+")"):response={})):response=doc,settings.onComplete.call(self,file,response),toDeleteFlag=!0,iframe.src="javascript:'<html></html>';"})},submit:function(){var e=this,t=this._settings;if(!this._input||this._input.value==="")return;var n=fileFromPath(this._input.value);if(!1===t.onSubmit.call(this,n,getExt(n))){this._clearInput();return}var r=this._createIframe(),i=this._createForm(r);removeNode(this._input.parentNode),removeClass(e._button,e._settings.hoverClass),removeClass(e._button,e._settings.focusClass),i.appendChild(this._input),i.submit(),removeNode(i),i=null,removeNode(this._input),this._input=null,this._getResponse(r,n),this._createInput()}}}();